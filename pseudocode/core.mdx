
## File Structure

```
app/
  Http/
    Schemas/
      Products/
        ProductIndexSchema.php
        ProductEditSchema.php
        ProductViewSchema.php
        Fragments/
          View/
            DetailsPanel.php
            VariantsTable.php
            ImagesTable.php
          Form/
            ProductBasics.php
            PricingFields.php
            InventoryFields.php
          List/
            ProductColumns.php
            ProductFilters.php
            ProductRowActions.php
      Shared/
        Fragments/
          Fields/
            AddressFields.php
            MoneyFields.php
            TaxFields.php
          Tables/
            AuditLogTable.php
            NotesTable.php
```

"Astra" belongs in the namespace, but not in the file structure, e.g.

```php
Astra\Pages\ViewPage
Astra\Blocks\RelatedTableBlock
Astra\Http\Controllers\ViewPageController
````

## Schema concept

```php
use Astra\Admin\Pages\ViewPage;
use Astra\IR\Block;
use Astra\IR\Layout;
use Astra\IR\Action;
use Astra\IR\Badge;
use Astra\IR\Panel;
use Illuminate\Http\Request;

ViewPage::make('products.view')
  ->component('Admin/ViewPage')
  ->layout('record-view') // e.g. regions: header, summary, main
  ->record(fn (Request $r) => Product::query()->findOrFail($r->route('product')))
  ->authorize('viewAny', \Domain\Products\Models\Product::class)
  ->navigation(fn ($page) => NavigationItem::make('Products')
      ->route('admin.products.index')
      ->icon('box')
      ->group('Catalog')
      ->order(10)
      ->can('viewAny', \Domain\Products\Models\Product::class)
  )
  ->breadcrumbs(fn ($page, $record) => BreadcrumbTrail::make()
      ->push('Catalog', route('admin.catalog'))
      ->push('Products', route('admin.products.index'))
      ->push($record->name, route('admin.products.view', $record))
  )
  ->defaultBlock('variants')
  ->regions([
    'header' => [
      Block\Header::make()
        ->title(fn (Product $p) => $p->name)
        ->badges(fn (Product $p) => [
          Badge::make('status')->from($p->status),
        ])
        ->actions(fn (Product $p) => [
          Action::link('Edit')->to(fn (Product $p) => route('admin.products.edit', $p)),
          Action::danger('Delete')->handler('products.delete'),
        ]),
    ],

    'summary' => [
      Block\Details::make('Details')
        ->fields([
          Block\Display::text('sku'),
          Block\Display::money('price')->currency('GBP'),
          Block\Display::text('status'),
        ])
        ->columns(2),
    ],

    'main' => [
      // A content “host” block. Not “layout”, just a UI container within the main region.
      Block\Panels::make()
        ->panels([
          Panel::make('variants')->label('Variants')->schema([
            Block\RelatedTable::make('Variants')
              ->stateKey('variants') // for querystring + client cache namespacing
              ->list(VariantsListPage::schema())
              ->scope(fn ($q, Product $p) => $q->where('product_id', $p->id))
              ->endpoint(fn (Product $p) => route('admin.products.variants.data', $p)),
          ]),

          Panel::make('images')->label('Images')->schema([
            Block\RelatedTable::make('Images')
              ->stateKey('images')
              ->list(ProductImagesListPage::schema())
              ->endpoint(fn (Product $p) => route('admin.products.images.data', $p)),
          ]),
        ]),
    ],
  ])
```

### Schema class

```php
namespace Astra\Http\Schemas\Products;

use Astra\Pages\ViewPage;

final class ProductViewSchema
{
    public static function build(Request $request): ViewPage
    {
        return ViewPage::make('products.view')
            ->component('Astra/ViewPage')
            ->record(fn () =>
                Product::query()->findOrFail($request->route('product'))
            )
            ->blocks([
                // …
            ]);
    }
}
```

### Controller

```php
use App\Http\Schemas\Products\ProductViewSchema;

final class ProductViewController extends ViewPageController
{
    protected function schema(Request $request): ViewPage
    {
        return ProductViewSchema::build($request);
    }
}
```

